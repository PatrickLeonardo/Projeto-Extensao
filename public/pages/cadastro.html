<!DOCTYPE html>
<html lang="pt-br">
    
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Cadastro Escala</title>
        <link href="../css/cadastro.css" rel="stylesheet">
    </head>
    
    <body>

        <center>

            <h1>Cadastrar em Escala</h1>
             
            <form>
                
                <label>Nome:</label>
                <input type="text" id="nome" value="">
                <br><br>

                <label>Função:</label>
                <select id="funcao">
                    <option value="Garçom">Garçom</option>
                    <option value="Matrie">Matrie</option>
                </select>
                <br><br>

                <label>CPF:</label>
                <input type="text" id="cpf" value="">
                <br><br>

                <label>RG:</label>
                <input type="text" id="rg" value="">
                <br><br>

                <label>Evento:</label>
                <select id="select_eventos"></select>
                <br><br>

                <input type="reset" value="Limpar">
                <input type="submit" id="submit" value="Cadastrar">

            </form>

        </center>
        
    </body>

    <script>
        
        const options = {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        };

        fetch('/eventos')
        .then(data => {
            
            if(!data.ok) {
                throw Error(data.status);
            }
            
            return data.json();
            
        }).then(update => {
            
            const select = document.getElementById("select_eventos");
            
            Array.from(update).forEach( (evento) => {
                
                select.innerHTML = select.innerHTML += `<option value="${evento.nome}"> ${evento.nome} </option>`
                
            });
            
        })

        const form = document.querySelector("form");

        form.addEventListener("submit", () => {

            event.preventDefault();

            const funcionario = document.getElementById("nome").value;
            const funcao      = document.getElementById("funcao").value;
            const cpf         = document.getElementById("cpf").value;
            const rg          = document.getElementById("rg").value;
            const evento      = document.getElementById("select_eventos").value;

            const options = {
                
                method: 'POST',

                headers: { 
                    'Accept': 'application/json',
                    'Content-Type': 'application/json' 
                },
                
                body: JSON.stringify({
                    funcionario: funcionario,
                    funcao: funcao,
                    CPF: cpf,
                    RG: rg,
                    evento: evento,
                }),
            };

            fetch('/nova_escala', options)
            .then(data => {
                
                if(!data.ok) {
                    
                    throw Error(data.status);
                    alert("Erro ao realizar cadastro, tente novamente...");
                    
                } else {
                    
                    form.reset(); 
                    alert("Cadastro realizado com sucesso!");
                    
                }
                
            });
            
        });
        
    </script>

</html>
